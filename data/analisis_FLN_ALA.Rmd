---
title: "Análisis Inferencial FLN y ALA"
author: "Equipo de investigación"
date: "`r Sys.Date()`"
output: "word_document"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(dplyr)
library(ggplot2)
library(broom)
library(car)
```

## Introducción

El presente análisis busca determinar si las personas con alto Fomento a la Lectura en la Niñez (FLN) conservaron su capacidad de atención lectora (medida como minutos continuos de lectura por sesión, variable P26) durante y después de la pandemia, en comparación con quienes tuvieron bajo FLN.

Se analizan los periodos prepandemia (2019), durante la pandemia (2021) y postpandemia (2023), con el fin de identificar si el tiempo de lectura disminuyó y si el FLN actuó como un factor protector frente a dicha caída.

Se cargan los datos combinados del cuestionario 2019–2023 para sostener el análisis inferencial. El nivel de significancia adoptado en todas las estimaciones es α = 0.04, equivalente a un 96% de confianza.

```{r carga_datos}
datos <- readr::read_csv(
  "nuevote_molec_light_2019_2021_2023.csv",
  locale = readr::locale(encoding = "Latin1"),
  show_col_types = FALSE
)

datos <- datos %>%
  rename(
    P26 = p26,
    P34_1 = p34_1,
    P34_2 = p34_2,
    P34_3 = p34_3,
    P36_1 = p36_1,
    P36_2 = p36_2,
    P36_3 = p36_3,
    P36_4 = p36_4
  )

names(datos)
dim(datos)
```

El análisis se centra en seguir la trayectoria del tiempo de lectura (ALA = P26) antes, durante y después de la pandemia para los grupos con FLN alto y bajo. La pregunta de investigación se formula así: **¿El fomento lector temprano permitió conservar sesiones de lectura prolongadas durante todo el periodo pandémico en comparación con quienes tuvieron un FLN bajo?**

El objetivo principal es comparar los cambios temporales en la duración de las sesiones de lectura y, en particular, determinar si contar con estímulos lectores tempranos amortigua la reducción que pudo haber ocurrido durante la emergencia sanitaria. El documento actualiza la estrategia inferencial previa para incorporar el eje temporal y contrastar la interacción entre FLN y periodo.

## Construcción de variables

- **FLN (Fomento a la Lectura en la Niñez).** Se modela a partir de los reactivos que describen experiencias lectoras en el hogar y la escuela mediante un modelo de mínimos cuadrados ordinarios con `P26` como variable dependiente. El puntaje ajustado (`FLN_score`) resume el aporte del conjunto de ítems al tiempo de lectura actual en los tres años observados.
- **Validación alternativa.** Como verificación robusta se propone un Análisis de Componentes Principales (PCA) sobre los indicadores de FLN para confirmar la consistencia del constructo. Si los componentes convergen con el puntaje del modelo lineal, se mantiene la solución; de lo contrario, se reevalúa la ponderación.
- **ALA (Actividad Lectora Actual).** Se define como `P26`, la cantidad de minutos continuos de lectura durante la sesión más reciente y funciona como proxy de la atención lectora.
- **Periodo.** Se crea una variable categórica `Periodo` con tres niveles —“Pre-pandemia” (2019), “Durante pandemia” (2021) y “Post-pandemia” (2023)—; cada uno representa el levantamiento del cuestionario antes de la emergencia sanitaria, durante las restricciones sanitarias y tras la reapertura gradual, respectivamente.
- **Clasificación de FLN.** Se construye una variable categórica `FLN_cat` con tres niveles —Bajo, Medio, Alto— usando los cuantiles 0.33 y 0.66 del `FLN_score`. Esta segmentación permite contrastar diferencias de tiempo de lectura entre grupos comparables en cada periodo.

```{r construccion_fln}
# puntaje continuo a partir del modelo lineal
modelo_fln <- lm(P26 ~ P34_1 + P34_2 + P34_3 + P36_1 + P36_2 + P36_3 + P36_4, data = datos)

datos <- datos %>%
  mutate(
    FLN_score = predict(modelo_fln, newdata = datos),
    Periodo = factor(
      dplyr::case_when(
        year == 2019 ~ "Pre-pandemia",
        year == 2021 ~ "Durante pandemia",
        year == 2023 ~ "Post-pandemia",
        TRUE ~ NA_character_
      ),
      levels = c("Pre-pandemia", "Durante pandemia", "Post-pandemia")
    ),
    FLN_cat = cut(
      FLN_score,
      breaks = quantile(FLN_score, probs = c(0, 1 / 3, 2 / 3, 1), na.rm = TRUE),
      include.lowest = TRUE,
      labels = c("Bajo", "Medio", "Alto")
    )
  )
```
## Estadística descriptiva

La exploración inicial resume el comportamiento de `P26` cruzando los niveles de FLN y los tres periodos (pre, durante y post pandemia) para identificar patrones temporales en la duración de las sesiones de lectura.

```{r tabla_resumen}
resumen_p26 <- datos %>%
  group_by(Periodo, FLN_cat) %>%
  summarise(
    n = sum(!is.na(P26)),
    media = mean(P26, na.rm = TRUE),
    sd = sd(P26, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(Periodo, FLN_cat)
resumen_p26
```

Esta tabla permite observar si el tiempo de lectura disminuyó del periodo pre-pandemia hacia 2021 y si se recuperó o mantuvo en 2023, resaltando si la caída es menor entre quienes contaron con un FLN alto.

```{r boxplot_p26}
ggplot(datos, aes(x = Periodo, y = P26, fill = FLN_cat)) +
  geom_boxplot(outlier.color = "firebrick") +
  labs(
    title = "Duración de lectura (P26) por periodo y nivel de FLN",
    x = "Periodo de levantamiento",
    y = "Minutos continuos de lectura",
    fill = "Nivel de FLN"
  ) +
  theme_minimal()
```

Los diagramas de cajas muestran la dispersión dentro de cada periodo y cómo cambian las medianas para FLN alto y bajo; una caída pronunciada en 2021 indicaría pérdida de retención lectora.

```{r dispersion_fln}
ggplot(datos, aes(x = FLN_score, y = P26, color = FLN_cat)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  facet_wrap(~Periodo) +
  labs(
    title = "Relación entre FLN y minutos continuos de lectura por periodo",
    x = "Puntaje continuo FLN",
    y = "Minutos continuos de lectura",
    color = "Nivel de FLN"
  ) +
  theme_minimal()
```

Las facetas por periodo permiten evaluar si el efecto lineal del FLN sobre la duración de lectura se mantiene estable a lo largo del tiempo o si se intensifica después de la pandemia.

```{r histograma_p26}
ggplot(datos, aes(x = P26, fill = Periodo)) +
  geom_histogram(binwidth = 5, color = "white", alpha = 0.8) +
  facet_wrap(~Periodo, ncol = 1) +
  labs(
    title = "Distribución de minutos continuos de lectura por periodo",
    x = "Minutos continuos (P26)",
    y = "Frecuencia"
  ) +
  theme_minimal() +
  guides(fill = "none")
```

El histograma facetado destaca si la distribución de `P26` se desplazó a valores menores durante la pandemia y si hubo recuperación posterior.

### Resumen temporal FLN × Periodo

El resumen de medias por periodo y nivel de FLN sirve como punto de partida para los contrastes inferenciales.

```{r resumen_temporal_tabla}
resumen_p26
```

```{r grafica_lineas_periodo}
lineas_periodo <- datos %>%
  group_by(Periodo, FLN_cat) %>%
  summarise(
    media = mean(P26, na.rm = TRUE),
    sd = sd(P26, na.rm = TRUE),
    n = sum(!is.na(P26)),
    .groups = "drop"
  )

ggplot(lineas_periodo, aes(x = Periodo, y = media, color = FLN_cat, group = FLN_cat)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  labs(
    title = "Evolución de P26 por periodo y nivel de FLN",
    x = "Periodo",
    y = "Media de minutos continuos de lectura",
    color = "Nivel de FLN"
  ) +
  theme_minimal()
```

La gráfica de líneas facilita interpretar la trayectoria 2019 → 2021 → 2023: una caída pronunciada en 2021 seguida de recuperación parcial en 2023 reflejaría el impacto de la pandemia, mientras que una pendiente más suave para FLN alto señalaría el efecto protector frente a la pérdida de concentración lectora.

## Intervalos de confianza (α = 0.04)

Se construyen intervalos al 96% de confianza, especificando la distribución base y el criterio de interpretación.

1. **Media de P26 (t de Student).**

```{r ic_media}
ic_media <- t.test(datos$P26, conf.level = 0.96)
ic_media
```

La distribución *t* se utiliza porque la desviación estándar poblacional es desconocida; el intervalo sugiere el rango plausible de la media poblacional de minutos continuos considerando todas las mediciones de 2019 a 2023.

2. **Diferencia de medias (FLN Alto vs Bajo, t de Welch).**

```{r ic_diferencia}
p26_alto <- datos %>% filter(FLN_cat == "Alto") %>% pull(P26)
p26_bajo <- datos %>% filter(FLN_cat == "Bajo") %>% pull(P26)
ic_diferencia <- t.test(p26_alto, p26_bajo, conf.level = 0.96, var.equal = FALSE)
ic_diferencia
```

Se emplea la versión de Welch al no asumir varianzas iguales. El intervalo indica si la brecha de minutos entre FLN alto y bajo es estadísticamente relevante a lo largo del periodo pandémico y posterior.

3. **Varianza de P26 (χ²).**

```{r ic_varianza}
n_total <- sum(!is.na(datos$P26))
s2 <- var(datos$P26, na.rm = TRUE)
chi_left <- qchisq(0.98, df = n_total - 1)
chi_right <- qchisq(0.02, df = n_total - 1)
ic_varianza <- c((n_total - 1) * s2 / chi_left, (n_total - 1) * s2 / chi_right)
ic_varianza
```

El intervalo basado en χ² estima la variabilidad poblacional del tiempo de lectura durante el trienio analizado, útil para contrastar si la dispersión aumentó en los años de pandemia.

4. **Proporción de lectura corta (< 20 minutos).**

```{r ic_proporcion}
lectura_corta <- mean(datos$P26 < 20, na.rm = TRUE)
n_corta <- sum(!is.na(datos$P26))
ic_prop <- prop.test(
  x = sum(datos$P26 < 20, na.rm = TRUE),
  n = n_corta,
  conf.level = 0.96
)
ic_prop
```

La aproximación normal (con corrección de continuidad) estima la proporción poblacional que mantiene sesiones breves durante y después de la pandemia; se puede ajustar el umbral según la definición institucional de lectura corta.

## Pruebas de hipótesis (α = 0.04)

Cada prueba reporta hipótesis nulas y alternativas, estadístico de prueba, valor crítico y p-value, complementando con conclusiones directas.

### ANOVA: `P26 ~ FLN_cat * Periodo`

- H₀: la media de `P26` es igual entre todos los niveles de FLN y entre los tres periodos, sin interacción.
- H₁: al menos un efecto principal o la interacción FLN × Periodo modifica la media de `P26`.

```{r anova_fln}
modelo_anova <- aov(P26 ~ FLN_cat * Periodo, data = datos)
anova_summary <- summary(modelo_anova)
anova_summary

df_fln <- anova_summary[[1]]["FLN_cat", "Df"]
df_periodo <- anova_summary[[1]]["Periodo", "Df"]
df_interaccion <- anova_summary[[1]]["FLN_cat:Periodo", "Df"]
df_res <- anova_summary[[1]]["Residuals", "Df"]

fcrit_fln <- qf(1 - 0.04, df_fln, df_res)
fcrit_periodo <- qf(1 - 0.04, df_periodo, df_res)
fcrit_interaccion <- qf(1 - 0.04, df_interaccion, df_res)
c(
  Fcrit_FLN = fcrit_fln,
  Fcrit_Periodo = fcrit_periodo,
  Fcrit_Interaccion = fcrit_interaccion
)
```

Los valores críticos se obtienen de la distribución *F* correspondiente a cada efecto (FLN, Periodo e interacción). Se rechaza H₀ a α = 0.04 cuando el estadístico F supera el valor crítico o el p-value es menor al nivel de significancia, lo que indicaría que el FLN alto amortiguó la caída de minutos durante y después de la pandemia.

### t de Welch: `P26` (FLN Alto vs Bajo)

- H₀: las medias de `P26` son iguales entre los niveles alto y bajo de FLN.
- H₁: las medias de `P26` difieren entre ambos niveles.

```{r t_welch}
prueba_welch <- t.test(p26_alto, p26_bajo, alternative = "two.sided", conf.level = 0.96)
prueba_welch

df_welch <- prueba_welch$parameter
tcrit_welch <- qt(1 - 0.04 / 2, df = df_welch)
tcrit_welch
```

El estadístico *t* se contrasta con el valor crítico bilateral a α = 0.04 (`tcrit_welch`). Un p-value menor que el nivel de significancia sugiere que el FLN alto funcionó como un factor protector al sostener sesiones de lectura más extensas durante y después de la pandemia.

### χ² de independencia: `FLN_cat` vs lectura corta

- H₀: FLN y lectura corta (< 20 minutos) son independientes.
- H₁: existe asociación entre FLN y lectura corta.

```{r chi_cuadrada}
datos <- datos %>%
  mutate(lectura_corta = factor(ifelse(P26 < 20, "Sí", "No")))

tabla_cont <- table(datos$FLN_cat, datos$lectura_corta)
prueba_chi <- chisq.test(tabla_cont, correct = FALSE)
prueba_chi

chi_critico <- qchisq(1 - 0.04, df = prueba_chi$parameter)
chi_critico
```

El estadístico χ² se contrasta con el valor crítico `chi_critico`, calculado para `(k - 1)(m - 1)` grados de libertad. Un resultado significativo implicaría que los niveles de FLN modifican la probabilidad de mantener sesiones cortas durante y después de la pandemia.

## Verificación de supuestos

1. **Normalidad.** Evaluada con Shapiro-Wilk o gráficos QQ en los residuos del modelo ANOVA factorial (`FLN_cat × Periodo`) y en las distribuciones de `P26` dentro de cada combinación.

```{r normalidad}
residuos_anova <- residuals(modelo_anova)
shapiro.test(residuos_anova)

qqplot_anova <- ggplot(data.frame(residuos = residuos_anova), aes(sample = residuos)) +
  stat_qq() + stat_qq_line() + theme_minimal() +
  labs(title = "QQ-plot de residuos ANOVA")
qqplot_anova
```

Si la normalidad no se cumple, se recomienda utilizar pruebas no paramétricas como Kruskal–Wallis o transformaciones logarítmicas.

2. **Homogeneidad de varianzas.** Contrastada con la prueba de Levene considerando los tres niveles de FLN y los tres periodos.

```{r homocedasticidad}
leveneTest(P26 ~ interaction(FLN_cat, Periodo), data = datos)
```

Ante varianzas heterogéneas, se mantienen estimadores robustos (ANOVA de Welch) o se recurre a comparaciones no paramétricas (p. ej., prueba de Brown–Forsythe).

3. **Conteos esperados en χ².** Se verifican que todos sean superiores a 5 para garantizar la validez asintótica al comparar FLN con lectura corta.

```{r conteos_esperados}
prueba_chi$expected
```

Si los conteos esperados son bajos, se sugiere combinar categorías o emplear un test exacto de Fisher.

## Conclusiones

Los resultados permiten observar la evolución del tiempo de lectura durante la pandemia. Si bien el promedio general puede haberse reducido, el grupo con alto FLN muestra una caída menor, lo que sugiere un efecto protector del fomento lector temprano frente a la pérdida de concentración lectora.
